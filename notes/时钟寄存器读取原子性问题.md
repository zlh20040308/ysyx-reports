# 时钟寄存器读取原子性问题  

今天发现在实现时钟的时候无法保证操作原子性，我现在没有头绪，我的解决过程如下：  

我把问题抽象成如下情景：  
假设现在有两个时钟，一个只能显示小时，另一个只能显示分钟，现在的时间是9:59，这两个时钟分别被放在两个房间里    

1. 假设先读小时再读分钟，或者读分钟再读小时，有可能出现下面这种情况：  

```  
9:59 // 第一次读取  
10：00 //第二次读取  
```
    1. 先读小时再读分钟，读出来就是9:00  
    2. 先读分钟再读小时，读出来就是10:59  
显然，这都不是我们想要的

2. 换种策略，读三次，先读小时，再读分钟，然后再读一遍小时，然后取第二次的小时和分钟组合：  

```  
9:59 // 第一次读取  
10：00 //第二次读取  
10：01 //第三次读取  
```

这次会读出10:00，貌似问题被解决了，实则不然：  

```  
9:59 // 第一次读取  
9:59 // 第二次读取  
10：01 //第三次读取  
```  

如果前两次读的比较快，就会发现读出来是10:59  

其他组合我也试过，但是都不能很好解决